# PASOS PARA PROBAR EL PROYECTO LOCALMENTE

## Estado Actual ‚úì

He completado:
1. ‚úì Creado `server/usuarios.db` con usuario admin (admin/admin123)
2. ‚úì Corregido mock server Python y ajustado funci√≥n de logs
3. ‚úì Creado script de compilaci√≥n `build_server.ps1` y `build_server_v2.ps1`
4. ‚úì Ejecutado tests pytest: **5 tests PASS** (4 en cliente/, 1 en cliente_py/)
5. ‚úì Creado `GUIA_PRUEBAS.md` con documentaci√≥n completa

---

## OPCI√ìN 1: PRUEBA R√ÅPIDA (Sin compilar C++)

**Tiempo estimado: 2 minutos**

### Terminal 1: Iniciar Mock Server
```powershell
Set-Location "c:\Users\edusa\OneDrive\Escritorio\Proyecto POO\Proyecto-Final-POO"
python .\cliente\tools\mock_servidor.py
```

Esperado:
```
Instancia de ApiRobotMock creada.
Usuarios v√°lidos: {'admin': '1234'}
Iniciando Mock Server en http://localhost:8000/RPC2 ...
Servidor listo. Esperando peticiones (Ctrl+C para salir).
```

### Terminal 2: Probar Conexi√≥n
```powershell
Set-Location "c:\Users\edusa\OneDrive\Escritorio\Proyecto POO\Proyecto-Final-POO"
python .\cliente\tools\probar_conexion.py
```

Esperado:
```
--- Probando http://localhost:8000/RPC2 -> conectar(admin, 1234) ---
Respuesta: sesion_token_1763250750.75026

--- Probando http://localhost:8080/RPC2 -> robot.login(admin, 1234) ---
Error: ConnectionRefusedError [WinError 10061] ...  (normal, C++ no corre)
```

### O Ejecutar Tests Autom√°ticos
```powershell
Set-Location "c:\Users\edusa\OneDrive\Escritorio\Proyecto POO\Proyecto-Final-POO"
python -m pytest -q cliente/tests/test_cliente.py -q
```

Esperado: **4 tests PASS** ‚úì

---

## OPCI√ìN 2: COMPILAR Y PROBAR SERVIDOR C++

**Tiempo estimado: 5-10 minutos (depende de compilador)**

### Requisito Previo: Compilador

**Opci√≥n A: MinGW-w64 (recomendado)**
```powershell
# Verifica si tienes g++
g++ --version

# Si NO est√° instalado:
# Descarga desde: https://www.mingw-w64.org/
# O instala via Chocolatey:
choco install mingw-w64
```

**Opci√≥n B: Visual Studio (si tienes instalado)**
- Ya tiene cl.exe, el script lo detectar√° autom√°ticamente

**Opci√≥n C: LLVM/Clang**
```powershell
# Descarga desde: https://releases.llvm.org/
# O instala via Chocolatey:
choco install llvm
```

### Paso 1: Compilar Servidor

```powershell
Set-Location "c:\Users\edusa\OneDrive\Escritorio\Proyecto POO\Proyecto-Final-POO"
PowerShell -ExecutionPolicy Bypass -File .\build_server.ps1
```

Esperado:
```
=== Compilando Servidor RPC en C++ ===
MinGW detectado: g++ (GCC) 11.2.0
Compilando... esto puede tomar minutos...
...
[OK] Compilacion exitosa!
Ejecutable: .\build\servidor_robot.exe
```

### Paso 2: Ejecutar Servidor

```powershell
Set-Location "c:\Users\edusa\OneDrive\Escritorio\Proyecto POO\Proyecto-Final-POO"
.\build\servidor_robot.exe
```

El servidor se inicia en `http://localhost:8080/RPC2` y abre una CLI administrativa.

### Paso 3: En otra Terminal, Probar Conexi√≥n

```powershell
Set-Location "c:\Users\edusa\OneDrive\Escritorio\Proyecto POO\Proyecto-Final-POO"
python .\cliente\tools\probar_conexion.py
```

Esperado: Ambas pruebas responden (mock `:8000` y servidor real `:8080`)

---

## ARCHIVOS NUEVOS / MODIFICADOS

### A√±adidos por m√≠:
- `server/usuarios.db` ‚Üí Base de usuarios (formato CSV)
- `cliente/tools/probar_conexion.py` ‚Üí Script de test de conectividad
- `build_server.ps1` y `build_server_v2.ps1` ‚Üí Scripts de compilaci√≥n
- `GUIA_PRUEBAS.md` ‚Üí Documentaci√≥n completa del proyecto

### Modificados por m√≠:
- `cliente/tools/mock_servidor.py` ‚Üí Ajuste en `obtener_historial_logs()` para devolver primeras N l√≠neas

---

## RESULTADOS DE TESTS

### Cliente Python (con Mock Server)
```
cliente/tests/test_cliente.py::test_conexion_exitosa PASSED [20%]
cliente/tests/test_cliente.py::test_conexion_fallida_clave PASSED [40%]
cliente/tests/test_cliente.py::test_operacion_sin_conexion PASSED [60%]
cliente/tests/test_cliente.py::test_operaciones_basicas_tras_conexion PASSED [80%]
cliente/tests/test_cliente.py::test_token_invalido_en_servidor PASSED [100%]
```

### Cliente Python 2
```
cliente_py/tests/test_controlador.py::TestControladorCliente::test_placeholder PASSED [100%]
```

**Total: 5 tests PASSED ‚úì**

---

## CREDENCIALES

### Mock Server (puerto 8000)
- Usuario: `admin`
- Contrase√±a: `1234`

### Servidor C++ (puerto 8080)
- Usuario: `admin`
- Contrase√±a: `admin123`
- Archivo: `server/usuarios.db`

---

## ARQUITECTURA DEL PROYECTO

```
[Cliente Python xmlrpc.client]
         ‚Üì HTTP XML-RPC
[Servidor XML-RPC]
    (Opci√≥n 1: Mock Python en :8000)
    (Opci√≥n 2: Servidor C++ en :8080)
         ‚Üì
[ControladorGeneral]
    ‚Üì          ‚Üì          ‚Üì
[Usuarios] [Archivos] [Robot]
    ‚Üì          ‚Üì          ‚Üì
[usuarios.db] [G-Code] [PuertoSerie ‚Üí Hardware]
```

---

## PROXIMAS MEJORAS (opcionales)

1. Compilaci√≥n con CMake (crear `CMakeLists.txt`)
2. Docker: imagen con servidor C++ precompilado
3. CI/CD (GitHub Actions): compilar y testear autom√°ticamente
4. Mejorar seguridad: hash de contrase√±as en `usuarios.db`
5. Tests integraci√≥n contra servidor C++ real

---

## COMANDOS R√ÅPIDOS (Copiar-Pegar)

### Iniciar Mock Server en Job de PowerShell (para dejar corriendo)
```powershell
Set-Location "c:\Users\edusa\OneDrive\Escritorio\Proyecto POO\Proyecto-Final-POO"
Start-Job -Name MockServer -ScriptBlock { python .\cliente\tools\mock_servidor.py }
# Ver jobs: Get-Job
# Parar: Stop-Job -Name MockServer; Remove-Job -Name MockServer
```

### Ejecutar cliente demo contra Mock
```powershell
Set-Location "c:\Users\edusa\OneDrive\Escritorio\Proyecto POO\Proyecto-Final-POO"
python .\cliente\src\cliente_robot.py
```

### Ejecutar todos los tests
```powershell
Set-Location "c:\Users\edusa\OneDrive\Escritorio\Proyecto POO\Proyecto-Final-POO"
python -m pytest cliente/tests/ cliente_py/tests/ -v
```

### Compilar y ejecutar servidor
```powershell
Set-Location "c:\Users\edusa\OneDrive\Escritorio\Proyecto POO\Proyecto-Final-POO"
PowerShell -ExecutionPolicy Bypass -File .\build_server.ps1
.\build\servidor_robot.exe
```

---

## TROUBLESHOOTING

| Problema | Soluci√≥n |
|----------|----------|
| `ConnectionRefusedError` | Inicia mock server o servidor C++ primero |
| `g++ no encontrado` | Instala MinGW-w64 o usa Visual Studio |
| `pytest no reconocido` | Usa `python -m pytest` en lugar de `pytest` |
| `ModuleNotFoundError` | Ejecuta desde la ra√≠z del repo |
| `Credenciales inv√°lidas` | Mock usa `admin/1234`, C++ usa `admin/admin123` |

---

**¬°Listo para probar! üöÄ**
